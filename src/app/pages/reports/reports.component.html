<app-home></app-home>

<div #pdfContent class="report-container">
    <div class="test">
        <div class="main-content-wrapper" dir="rtl">
            <h2 class="page-title">ููุญุฉ ุชุญูู ุงูููุชุจุฉ ๐</h2>

            <div *ngIf="errorMessage" class="alert error">{{ errorMessage }}</div>
            
            <div class="stats-grid" *ngIf="stats">
                
                <div class="stat-card total-books">
                    <h3 class="card-title">ุฅุฌูุงูู ุงููุชุจ</h3>
                    <p class="stat-value">{{ stats.totalBooks }}</p>
                </div>

                <div class="stat-card total-members">
                    <h3 class="card-title">ุฅุฌูุงูู ุงูุฃุนุถุงุก ุงููุณุฌููู</h3>
                    <p class="stat-value">{{ stats.totalMembers }}</p>
                </div>

                <div class="stat-card active-members">
                    <h3 class="card-title">ุฃุนุถุงุก ูุดุทูู (ุงุณุชุนุงุฑูุง)</h3>
                    <p class="stat-value">{{ stats.activeMembers }}</p>
                </div>

                <div class="stat-card currently-borrowed">
                    <h3 class="card-title">ูุชุจ ููุณุชุนุงุฑุฉ ุญุงููุงู</h3>
                    <p class="stat-value">{{ stats.borrowedBooks }}</p>
                </div>

                <div class="stat-card overdue-books">
                    <h3 class="card-title">ูุชุจ ูุชุฃุฎุฑุฉ โ๏ธ</h3>
                    <p class="stat-value">{{ stats.overdueBooks }}</p>
                </div>
            </div>
            
            <div *ngIf="loadingReports" class="loading-state">ุฌุงุฑู ุชุญููู ุงูุชูุงุฑูุฑ ุงูุชูุตูููุฉ...</div>

            <div class="detailed-reports-section" *ngIf="!loadingReports">
                
                <div class="report-table-box overdue-report">
                    <h4 class="report-title">ุณุฌูุงุช ุงูุงุณุชุนุงุฑุฉ ุงููุชุฃุฎุฑุฉ ({{ stats.overdueBooks }})</h4>
                    <table *ngIf="stats.overdueBooks > 0; else noOverdue">
                        <thead>
                            <tr>
                                <th style="width: 30%;">ุงููุชุงุจ</th>
                                <th style="width: 25%;">ุงูุนุถู</th>
                                <th style="width: 25%;">ุชุงุฑูุฎ ุงูุงุณุชุญูุงู</th>
                                <th style="width: 20%;">ุฃูุงู ุงูุชุฃุฎูุฑ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of overdueBooks">
                                <td>{{ item.bookTitle }}</td>
                                <td>{{ item.memberName }}</td>
                                <td>{{ item.dueDate | date:'shortDate' }}</td>
                                <td class="late-days">{{ item.daysLate }} ููู</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="side-by-side-reports">
                    <div class="report-list-box">
                        <h4 class="report-title">ุงููุชุจ ุงูุฃูุซุฑ ุงุณุชุนุงุฑุฉ (Top 5)</h4>
                        <ul *ngIf="mostBorrowedBooks.length > 0; else noBooks">
                            <li *ngFor="let item of mostBorrowedBooks">
                                <span class="list-item-text">{{ item.title }}</span>
                                <span class="count">{{ item.borrowCount }} ุงุณุชุนุงุฑุฉ</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="report-list-box">
                        <h4 class="report-title">ุงูุฃุนุถุงุก ุงูุฃูุซุฑ ูุดุงุทุงู (Top 5)</h4>
                        <ul *ngIf="mostActiveMembers.length > 0; else noMembers">
                            <li *ngFor="let item of mostActiveMembers">
                                <span class="list-item-text">{{ item.memberName }}</span>
                                <span class="count">{{ item.borrowCount }} ุงุณุชุนุงุฑุฉ</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <button (click)="exportServerPdf()"
                        class="export-button"
                        [disabled]="downloading">
                {{ downloading ? '...ุฌุงุฑู ุงูุชุญุถูุฑ' : 'ุชุตุฏูุฑ ุงูุชูุฑูุฑ ูู PDF ๐ (ูู ุงูุฎุงุฏู)' }}
                </button>
            </div>

            <ng-template #noBooks><p class="muted">ูุง ุชูุฌุฏ ุจูุงูุงุช ูุชุจ ูุงููุฉ.</p></ng-template>
            <ng-template #noMembers><p class="muted">ูุง ุชูุฌุฏ ุจูุงูุงุช ุฃุนุถุงุก ูุงููุฉ.</p></ng-template>
            <ng-template #noOverdue><p class="muted">ูุง ุชูุฌุฏ ูุชุจ ูุชุฃุฎุฑุฉ ุญุงููุงู. (ููุชุงุฒ!)</p></ng-template>

        </div>
    </div>
</div>
